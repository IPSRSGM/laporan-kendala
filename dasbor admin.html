<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dasbor Admin / Teknisi</title>
</head>
<body>

<h2>Dasbor Laporan Kendala</h2>

<div id="daftarLaporan">
  Memuat data...
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "PASTE_DARI_FIREBASE",
    authDomain: "xxxxx.firebaseapp.com",
    projectId: "laporan-kendala-rsgm-165f6"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  db.collection("laporan")
    .orderBy("waktu", "desc")
    .onSnapshot(snapshot => {

      let html = "";

      if (snapshot.empty) {
        html = "Belum ada laporan";
      } else {
        snapshot.forEach(doc => {
          const d = doc.data();

          html += `
            <div style="border:1px solid #333;padding:10px;margin-bottom:10px">
              <b>Nama:</b> ${d.nama}<br>
              <b>Unit:</b> ${d.unit}<br>
              <b>Kendala:</b> ${d.kendala}<br>

              <label>Status:</label>
              <select onchange="ubahStatus('${doc.id}', this.value)">
                <option value="baru" ${d.status === "baru" ? "selected" : ""}>Baru</option>
                <option value="proses" ${d.status === "proses" ? "selected" : ""}>Proses</option>
                <option value="pending" ${d.status === "pending" ? "selected" : ""}>Pending</option>
                <option value="selesai" ${d.status === "selesai" ? "selected" : ""}>Selesai</option>
              </select>
              <br><br>

              <textarea
                placeholder="Respon teknisi"
                onblur="ubahRespon('${doc.id}', this.value)"
                style="width:100%;height:60px"
              >${d.respon || ""}</textarea>
            </div>
          `;
        });
      }

      document.getElementById("daftarLaporan").innerHTML = html;
    });

  function ubahStatus(id, status) {
    db.collection("laporan").doc(id).update({
      status: status
    });
  }

  function ubahRespon(id, respon) {
    db.collection("laporan").doc(id).update({
      respon: respon
    });
  }
</script>

</body>
</html>
