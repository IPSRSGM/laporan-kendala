<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Laporan Kendala Sarpras RSGM Unair</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Poppins,sans-serif;
  background:linear-gradient(135deg,#4facfe,#00f2fe);
  padding:30px 0;
}
.app{
  max-width:600px;
  margin:auto;
  background:rgba(255,255,255,.25);
  backdrop-filter:blur(16px);
  border-radius:22px;
  padding:26px;
}
.header{text-align:center;color:#fff}
label{color:#fff;font-size:13px;margin-top:14px;display:block}
input,textarea{
  width:100%;padding:14px;margin-top:6px;
  border-radius:14px;border:none
}
button{
  width:100%;margin-top:20px;padding:16px;
  border:none;border-radius:16px;
  background:#4f46e5;color:#fff;font-weight:600
}
.search{
  margin-top:20px;
}
.laporan-item{
  background:#fff;border-radius:14px;
  padding:12px;margin-top:12px
}
.status-bar{
  padding:6px 12px;border-radius:12px;
  color:#fff;font-size:12px;font-weight:600
}
.baru{background:#f59e0b}
.proses{background:#3b82f6}
.selesai{background:#22c55e}
.waktu{
  font-size:12px;
  color:#555;
  margin-top:4px;
}
</style>
</head>

<body>
<div class="app">
  <div class="header">
    <h2>ğŸ“‹ Laporan Kendala Sarpras</h2>
    <p>RSGM Universitas Airlangga</p>
  </div>

  <label>Nama</label>
  <input id="nama">
  <label>Unit / Ruangan</label>
  <input id="unit">
  <label>Kendala</label>
  <textarea id="kendala"></textarea>

  <button onclick="kirim()">ğŸš€ Kirim Laporan</button>

  <!-- SEARCH -->
  <input id="search" class="search" placeholder="ğŸ” Cari nama / unit / tanggal (dd/mm/yyyy)" oninput="render()">

  <div id="list"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"ISI_API_KEY_KAMU",
  authDomain:"laporan-kendala-rsgm-165f6.firebaseapp.com",
  projectId:"laporan-kendala-rsgm-165f6"
});
const db=firebase.firestore();

let allData=[];

// KIRIM LAPORAN
function kirim(){
  if(!nama.value || !unit.value || !kendala.value){
    alert("Lengkapi data");
    return;
  }

  db.collection("laporan").add({
    nama:nama.value,
    unit:unit.value,
    kendala:kendala.value,
    status:"baru",
    respon:"",
    waktu:firebase.firestore.FieldValue.serverTimestamp()
  });

  nama.value=unit.value=kendala.value="";
}

// REALTIME LOAD
db.collection("laporan")
.orderBy("waktu","desc")
.onSnapshot(snap=>{
  allData=[];
  snap.forEach(d=>{
    const x=d.data();
    if(x.waktu){
      allData.push(x);
    }
  });
  render();
});

// RENDER + SEARCH
function render(){
  const key=document.getElementById("search").value.toLowerCase();
  list.innerHTML="";

  allData.filter(x=>{
    const t=x.waktu.toDate();
    const tanggal=t.toLocaleDateString("id-ID");
    return (
      x.nama.toLowerCase().includes(key) ||
      x.unit.toLowerCase().includes(key) ||
      tanggal.includes(key)
    );
  }).forEach(x=>{
    const t=x.waktu.toDate();
    const waktu=t.toLocaleString("id-ID");

    list.innerHTML+=`
      <div class="laporan-item">
        <b>${x.nama}</b> (${x.unit})<br>
        ğŸ›  ${x.kendala}<br>
        <div class="waktu">ğŸ•’ ${waktu}</div>
        <span class="status-bar ${x.status}">${x.status}</span><br>
        ${x.respon?`ğŸ’¬ ${x.respon}`:"â³ Menunggu teknisi"}
      </div>`;
  });
}
</script>
</body>
</html>
