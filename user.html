<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Laporan Kendala Sarpras RSGM</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Poppins,sans-serif;
  background:linear-gradient(135deg,#4facfe,#00f2fe);
  min-height:100vh;
  display:flex;
  justify-content:center;
  padding:20px;
}
.app{
  background:white;
  max-width:650px;
  width:100%;
  padding:20px;
  border-radius:18px;
}
h3{text-align:center}

input,textarea,button{
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:10px;
  border:1px solid #ccc;
  font-family:Poppins;
}
button{
  background:#2563eb;
  color:white;
  border:none;
  font-weight:600;
  cursor:pointer;
}

.filter{
  background:#f1f5f9;
  padding:12px;
  border-radius:12px;
  margin-top:15px;
}

.item{
  background:#f8fafc;
  padding:12px;
  border-radius:12px;
  margin-top:12px;
}
.status{
  padding:4px 10px;
  border-radius:12px;
  color:white;
  font-size:12px;
  display:inline-block;
}
.baru{background:#fbbf24}
.proses{background:#3b82f6}
.pending{background:#a855f7}
.selesai{background:#22c55e}
.waktu{
  font-size:12px;
  color:#555;
}
</style>
</head>

<body>

<div class="app">
<h3>ğŸ“‹ Laporan Kendala Sarpras</h3>

<!-- FORM INPUT -->
<input id="nama" placeholder="Nama Pelapor">
<input id="unit" placeholder="Unit / Ruangan">
<textarea id="kendala" placeholder="Deskripsi Kendala"></textarea>
<button onclick="kirim()">ğŸš€ Kirim Laporan</button>

<!-- FILTER -->
<div class="filter">
  <b>ğŸ” Pencarian Laporan</b>
  <input id="searchInput" placeholder="Cari nama / unit / keluhan">
  <input type="date" id="dateInput">
</div>

<!-- LIST -->
<div id="list"></div>
</div>

<script>
firebase.initializeApp({
  apiKey: "ISI_API_KEY",
  authDomain: "PROJECT.firebaseapp.com",
  projectId: "PROJECT_ID"
});

const db = firebase.firestore();
const list = document.getElementById("list");

let allData=[];

// KIRIM LAPORAN
function kirim(){
  if(!nama.value||!unit.value||!kendala.value){
    alert("Lengkapi semua kolom");
    return;
  }

  db.collection("laporan").add({
    nama:nama.value,
    unit:unit.value,
    kendala:kendala.value,
    status:"baru",
    respon:"",
    waktu:firebase.firestore.FieldValue.serverTimestamp()
  });

  nama.value="";
  unit.value="";
  kendala.value="";
}

// REALTIME AMBIL DATA
db.collection("laporan")
.orderBy("waktu","desc")
.onSnapshot(snap=>{
  allData=[];
  snap.forEach(doc=>{
    const d=doc.data();
    if(d.waktu){
      allData.push(d);
    }
  });
  render();
});

// RENDER + FILTER
function render(){
  list.innerHTML="";
  const search = document.getElementById("searchInput").value.toLowerCase();
  const date = document.getElementById("dateInput").value;

  allData.filter(d=>{
    const cocokText =
      d.nama.toLowerCase().includes(search) ||
      d.unit.toLowerCase().includes(search) ||
      d.kendala.toLowerCase().includes(search);

    let cocokTanggal = true;
    if(date && d.waktu){
      cocokTanggal =
        d.waktu.toDate().toISOString().slice(0,10) === date;
    }
    return cocokText && cocokTanggal;
  }).forEach(d=>{
    list.innerHTML+=`
      <div class="item">
        <div class="waktu">ğŸ•’ ${d.waktu.toDate().toLocaleString("id-ID")}</div>
        <b>${d.nama}</b> â€“ ${d.unit}<br>
        ğŸ› ï¸ ${d.kendala}<br>
        <span class="status ${d.status}">
          ${d.status.toUpperCase()}
        </span>
        <div>
          ${d.respon
            ? "ğŸ’¬ "+d.respon
            : "<span style='color:#777'>â³ Menunggu teknisi</span>"}
        </div>
      </div>
    `;
  });
}

// EVENT FILTER
document.getElementById("searchInput").addEventListener("input",render);
document.getElementById("dateInput").addEventListener("change",render);
</script>

</body>
</html>
